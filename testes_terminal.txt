===============================================================
CHECKPOINT 3 - IoT ESP32 / Node-RED / Mosquitto
Autor: Vinicius Rodrigues de Oliveira
Data: Novembro/2025
===============================================================

üõ∞Ô∏è  OBJETIVO
---------------------------------------------------------------
Validar a comunica√ß√£o completa entre Node-RED, Mosquitto MQTT Broker
e o cliente externo (MacBook), garantindo a transmiss√£o e recep√ß√£o
de mensagens MQTT entre dispositivos e servi√ßos.

---------------------------------------------------------------
ETAPA 1 - TESTES DE PORTAS E CONEX√ÉO SSH
---------------------------------------------------------------
nc -vz 172.200.90.234 22        # Porta SSH - OK (Succeeded)
nc -vz 172.200.90.234 1880      # Porta Node-RED - Connection refused (inicialmente)
nc -vz 172.200.90.234 1883      # Porta Mosquitto MQTT - OK (Succeeded ap√≥s libera√ß√£o)

---------------------------------------------------------------
ETAPA 2 - STATUS DOS SERVI√áOS NA VM (Ubuntu Server)
---------------------------------------------------------------
sudo systemctl status mosquitto --no-pager
sudo systemctl status nodered --no-pager

sudo ss -ltnp | grep 1883        # Valida se o Mosquitto escuta na porta 1883
sudo ss -ltnp | grep 1880        # Valida se o Node-RED est√° ativo na 1880

---------------------------------------------------------------
ETAPA 3 - TESTE LOCAL DO BROKER MQTT
---------------------------------------------------------------
# Inscri√ß√£o e publica√ß√£o local no broker da VM
mosquitto_sub -h localhost -t teste/topico -u admin -P 'Fiap@2tdsvms' -v
mosquitto_pub -h localhost -t teste/topico -m "Ol√° MQTT!" -u admin -P 'Fiap@2tdsvms'

# Resultado esperado:
teste/topico Ol√° MQTT!

---------------------------------------------------------------
ETAPA 4 - TESTE REMOTO (MacBook -> VM)
---------------------------------------------------------------
# Publica√ß√£o a partir do Mac
mosquitto_pub -h 172.200.90.234 -t teste/topico -m "ping do Mac" -u admin -P 'Fiap@2tdsvms'

# Resultado observado no terminal da VM:
teste/topico ping do Mac

---------------------------------------------------------------
ETAPA 5 - TESTE NODE-RED PUBLICANDO VIA MQTT
---------------------------------------------------------------
# No Node-RED (fluxo configurado com MQTT OUT e t√≥pico teste/topico)
# Clicando no n√≥ 'Inject'

# Resultado observado no terminal da VM:
teste/topico Ol√° do Node-RED!

---------------------------------------------------------------
ETAPA 6 - VERIFICA√á√ÉO FINAL
---------------------------------------------------------------
sudo systemctl status mosquitto --no-pager    # Deve mostrar Active (running)
sudo ss -ltnp | grep 1883                     # Porta aberta
sudo ss -ltnp | grep 1880                     # Porta aberta

# Comunica√ß√£o validada em ambos os sentidos:
# Node-RED ‚Üí Mosquitto ‚Üí Cliente (Mac)
# Cliente (Mac) ‚Üí Mosquitto ‚Üí Node-RED

===============================================================
‚úÖ CONCLUS√ÉO
---------------------------------------------------------------
A comunica√ß√£o MQTT foi testada com sucesso entre o Node-RED, 
o broker Mosquitto e o cliente remoto (MacBook). O sistema
est√° funcional e pronto para integra√ß√£o com o ESP32 (Q4).
===============================================================

